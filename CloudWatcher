/*************************************************** 
  This is a library example for the MLX90614 IR Temp Sensor. This example is from https://learn.adafruit.com/using-melexis-mlx90614-non-contact-sensors/wiring-and-test.

  Connect 5V pin to 5 volts
  Connect GND to ground
  Connect SCL to the SCL pin and tie the SCL pin to high via 10k Ohm resistor
  Connect SDA to the SDA pin and tie the SDA pin to high via 10k Ohm resistor

  This sketch also uses a temperature sensor for ambient conditions.

  Connect the 5V pin to 5 Volts (5V).
  Connect the SIGNAL pin to ANALOG pin 0.
  Connect the GND pin to ground (GND).
  
  In this sketch we'll communicate with the serial monitor.
  
 ****************************************************/

#include <Wire.h>
#include <Adafruit_MLX90614.h>
#include <LiquidCrystal.h>

Adafruit_MLX90614 mlx = Adafruit_MLX90614();

// Declare that on pin0 is tied the output of the temperature sensor
const int temperaturePin = 0;
float offset = 11.6;  // temperature compensation for the ambient sensor (it reads 10F too low)

//setup globals
float voltage, degreesC, degreesF, AirTemperatureF, IRTemperatureF;

// Initialize the library with the pins we're using.
// See http://arduino.cc/en/Reference/LiquidCrystal
LiquidCrystal lcd(12,11,5,4,3,2);

void setup() {
  Serial.begin(9600);
  
  mlx.begin();           //start the MLX90614

  lcd.begin(16, 2);      // Initialize the LiquidCrystal based on its size
  
}

void loop() {
  lcd.clear();           // clear the LCD
  lcd.setCursor(0,0);    // cursor in home position
 
  //AirTemperatureF = ((getVoltage(temperaturePin) - 0.5) * 100.0 * (9.0/5.0) ) + 32.0 + offset;
  IRTemperatureF = mlx.readObjectTempF();
  
//  lcd.print(AirTemperatureF);
  //Serial.print("temp sensor = ");Serial.println(AirTemperatureF);
  //Serial.print("IR Ambient = "); Serial.println(mlx.readAmbientTempF()); 
  //Serial.println();
  
//  lcd.setCursor(0,1);
  //lcd.print((int)abs(AirTemperatureF - IRTemperatureF));
  lcd.print((int)abs(mlx.readAmbientTempF() - IRTemperatureF));
  //Serial.println(mlx.readAmbientTempF() - IRTemperatureF);
  
  //lcd.print(" IR="); lcd.print(mlx.readObjectTempF());     //print the first line
  //lcd.setCursor(0,1);    // now move cursor to 1st column of second row 
  //lcd.print("Air="); lcd.print(((getVoltage(temperaturePin) - 0.5) * 100.0 * (9.0/5.0) ) + 32.0);    //print second line
  
  // delay 2 secs 
  delay(2000); 
}

float getVoltage(int pin)
{
  return (analogRead(pin) * 0.004882814);
  
  // This equation converts the 0 to 1023 value that analogRead()
  // returns, into a 0.0 to 5.0 value that is the true voltage
  // being read at that pin.
}
